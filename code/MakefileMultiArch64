# --- OceanDepth Makefile (multi-arch 64-bit) ---

#¬†make -f MakefileMultiArch64
# ne peux etre execut√© que sous linux x86_64 (pas arm64)

CC          = gcc
CC_ARM64    = aarch64-linux-gnu-gcc
CC_WIN64    = x86_64-w64-mingw32-gcc
WINDRES		= x86_64-w64-mingw32-windres

CFLAGS      = -Wall -Wextra -O2 -std=c99

TARGET		= oceandepth
SRCDIR      = src
OUTDIR      = output

SOURCES     = $(wildcard $(SRCDIR)/*.c)

# --- Plateforme Linux ---
TARGET_LINUX_x86_64 = $(TARGET)_linux_x86_64
TARGET_LINUX_arm64  = $(TARGET)_linux_arm64

# --- Plateforme Windows ---
TARGET_WIN64        = $(TARGET)_win64.exe
RCFILE              = rc/icon.rc
ICONRES             = rc/icon.o

# --- Cibles principales ---
.PHONY: all linux_x86_64 linux_arm64 win64 clean debug prod valgrind

all: linux_x86_64 linux_arm64 win64

linux_x86_64:
	@echo "üêß Compilation Linux x86_64..."
	@mkdir -p $(OUTDIR)
	$(CC) $(SOURCES) -o $(OUTDIR)/$(TARGET_LINUX_x86_64) $(CFLAGS)

linux_arm64:
	@echo "üê† Compilation Linux arm64..."
	@mkdir -p $(OUTDIR)
	$(CC_ARM64) $(SOURCES) -o $(OUTDIR)/$(TARGET_LINUX_arm64) $(CFLAGS)

# --- Compilation Windows avec ic√¥ne ---
win64: $(ICONRES)
	@echo "üí† Compilation Windows 64-bit avec ic√¥ne..."
	@mkdir -p $(OUTDIR)
	$(CC_WIN64) $(SOURCES) $(ICONRES) -o $(OUTDIR)/$(TARGET_WIN64) $(CFLAGS)

# --- Compilation du fichier .rc en .o ---
$(ICONRES): $(RCFILE)
	@echo "üé® G√©n√©ration de la ressource ic√¥ne..."
	$(WINDRES) $< -O coff -o $@

# --- Nettoyage ---
clean:
	rm -f $(OUTDIR)/$(TARGET)_* $(ICONRES)

# --- Debug (inclut debug symbols et flag DEBUG) ---
debug: CFLAGS += -g -DDEBUG
debug: clean all

# --- Valgrind ---
valgrind: debug
	cd $(OUTDIR) && valgrind -v --leak-check=full --track-origins=yes ./$(TARGET)_linux_x86_64 && cd ..

# --- Production (optimisation -O3 sans debug) ---
prod: CFLAGS += -O3 -DNDEBUG
prod: clean all
